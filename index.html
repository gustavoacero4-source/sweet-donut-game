<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sweet Donut VR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
body{margin:0;overflow:hidden;background:#ffd6e8;font-family:Arial,sans-serif}
#hud{position:absolute;top:10px;left:10px;background:rgba(255,255,255,.9);padding:10px 14px;border-radius:12px;font-size:16px;z-index:10}
#logo{position:absolute;top:10px;right:10px;background:#ff77aa;color:#fff;padding:10px 16px;border-radius:20px;font-weight:bold;z-index:10}
#message{display:none;position:absolute;inset:0;background:rgba(255,182,213,.95);color:#7a2e4a;font-size:32px;justify-content:center;align-items:center;text-align:center;z-index:20}
</style>
</head>

<body>

<div id="hud">
Nivel: <span id="level">1</span><br>
Tiempo: <span id="time">30</span>s<br>
Donas: <span id="score">0</span> / <span id="goal">10</span>
</div>

<div id="logo">üç© Sweet Donut VR</div>
<div id="message"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/jsm/webxr/VRButton.js"></script>

<script>
let scene=new THREE.Scene();
let camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,100);
camera.position.set(0,1.6,5);

let renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.xr.enabled=true;
document.body.appendChild(renderer.domElement);
document.body.appendChild(VRButton.createButton(renderer));

scene.add(new THREE.AmbientLight(0xffffff,.6));
let light=new THREE.PointLight(0xffffff,1);
light.position.set(5,5,5);
scene.add(light);

let floor=new THREE.Mesh(
  new THREE.PlaneGeometry(50,50),
  new THREE.MeshStandardMaterial({color:0xffc0d9})
);
floor.rotation.x=-Math.PI/2;
scene.add(floor);

let donuts=[],score=0,level=1,timeLeft=30,goal=10,gameActive=true;

function spawnDonut(){
  let d=new THREE.Mesh(
    new THREE.TorusGeometry(.4,.18,16,32),
    new THREE.MeshStandardMaterial({color:0xff77aa})
  );
  d.position.set((Math.random()-.5)*6,4,camera.position.z-Math.random()*10);
  scene.add(d);
  donuts.push(d);
}

setInterval(()=>gameActive&&spawnDonut(),900);

let raycaster=new THREE.Raycaster();
let center=new THREE.Vector2(0,0);

function collect(){
  raycaster.setFromCamera(center,camera);
  let hits=raycaster.intersectObjects(donuts);
  if(hits.length){
    let d=hits[0].object;
    scene.remove(d);
    donuts=donuts.filter(x=>x!==d);
    score++;
    document.getElementById("score").textContent=score;
  }
}

window.addEventListener("click",collect);
window.addEventListener("touchstart",collect);

function nextLevel(){
  level++;score=0;timeLeft=30;goal+=10;
  document.getElementById("level").textContent=level;
  document.getElementById("goal").textContent=goal;
}

setInterval(()=>{
  if(!gameActive)return;
  timeLeft--;
  document.getElementById("time").textContent=timeLeft;
  if(score>=goal)nextLevel();
  if(timeLeft<=0){
    gameActive=false;
    let m=document.getElementById("message");
    m.style.display="flex";
    m.innerHTML="üò¢ Tiempo terminado<br>Donas: "+score;
  }
},1000);

renderer.setAnimationLoop(()=>{
  camera.position.z-=0.02;
  donuts.forEach(d=>{
    d.rotation.x+=.02;
    d.rotation.y+=.02;
    d.position.y-=.04;
  });
  renderer.render(scene,camera);
});
</script>
</body>
</html>
